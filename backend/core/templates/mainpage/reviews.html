{% load static %}
{% load i18n %}

<section class="layout-pt-xl layout-pb-xl relative">
  <div class="sectionBg -w-1530 rounded-12 bg-light-1"></div>
  
  <div data-anim-wrap class="container">
    <div data-anim-child="slide-up" class="row justify-between items-end y-gap-10">
      <div class="col-auto">
        <h2 class="text-30 md:text-24">{% trans "We are the best-rated for day trips from Milan on the internet." %}</h2>
        <p>{% trans "Real reviews from Google and TripAdvisor - see what our clients really think about our tours." %}</p>
      </div>
      <div class="col-auto col-sm-2">
        <div class="d-flex items-center">
          <a href="https://www.google.com/maps/place/Abroads+Tours/@45.5449712,9.2380265,17z" target="_blank" rel="noopener noreferrer">
            <img src="{% static 'img/testimonials/1/google_review2.svg' %}" alt="Google Reviews" loading="lazy">
          </a>
        </div>
      </div>
    </div>
    
    <div data-anim-child="slide-up delay-2" class="relative pt-40 sm:pt-20">
      <!-- УПРОЩЕННАЯ ВЕРСИЯ: убираем сложную логику автозагрузки -->
      <div class="overflow-hidden pb-30 js-section-slider" 
           data-gap="30" 
           data-slider-cols="xl-3 lg-3 md-2 sm-1 base-1" 
           data-nav-prev="js-slider1-prev" 
           data-nav-next="js-slider1-next">
        
        <div class="swiper-wrapper" id="reviews-container">
          <!-- ПОКАЗЫВАЕМ ВСЕ ОТЗЫВЫ СРАЗУ -->
          {% for review in reviews_data.reviews %}
          {% if review.rating == 5 %}
          <div class="swiper-slide" data-review-id="{{ review.review_id }}">
            <div class="tourCard -type-1 py-10 px-10 border-1 rounded-12 bg-white -hover-shadow">
              <div class="tourCard__header px-10 pt-10">
                <div class="testi-author-box">
                  <div class="testi-author">
                    <div class="author-thumb">
                      {% if review.author_photo_url %}
                        <img src="{{ review.author_photo_url }}" alt="{% trans 'Author photo' %}" loading="lazy" 
                             style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                      {% else %}
                        <div style="width: 50px; height: 50px; border-radius: 50%; 
                                    background: linear-gradient(135deg, 
                                    {% if review.source == 'tripadvisor' %}#00AA6C{% elif review.source == 'google' %}#DAC5A7{% else %}#B8A082{% endif %} 0%, 
                                    {% if review.source == 'tripadvisor' %}#009960{% elif review.source == 'google' %}#B8A082{% else %}#A18B6B{% endif %} 100%); 
                                    display: flex; align-items: center; justify-content: center; 
                                    color: white; font-weight: bold; font-size: 18px;">
                          {{ review.author_name|first|upper }}
                        </div>
                      {% endif %}
                    </div>
                    <div class="content" style="display: flex; flex-direction: column; align-items: flex-start;">
                      <h6 class="name">{{ review.author_name }}</h6>
                      <span>
                        <div class="tourCard__rating d-flex items-center text-13 mt-5">
                          <div class="d-flex x-gap-5">
                            {% for i in "12345" %}
                              {% if forloop.counter <= review.rating %}
                                <div><i class="icon-star text-10 text-yellow-2"></i></div>
                              {% else %}
                                <div><i class="icon-star text-10 text-light-2"></i></div>
                              {% endif %}
                            {% endfor %}
                          </div>
                          <span class="text-dark-1 ml-10">{{ review.rating }}.0</span>
                        </div>
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tourCard__content px-10 pt-10">
                <h3 class="tourCard__title text-16 fw-500 mt-5">
                  "{% if review.text|length > 150 %}{{ review.text|truncatewords:25 }}...{% else %}{{ review.text }}{% endif %}"
                </h3>

                <div class="d-flex justify-between items-center text-13 text-dark-1 pt-10 mt-10">
                  <div class="d-flex items-center">
                    {{ review.relative_time_description }}
                  </div>
                  <div class="testimonials__slider-meta-icon">
                    {% if review.source == 'tripadvisor' %}
                      <!-- TripAdvisor Logo -->
                      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="38px" height="38px" viewBox="0 0 38 38" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(20.392157%,87.843138%,63.137257%);fill-opacity:1;" d="M 38 19 C 38 8.507812 29.492188 0 19 0 C 8.507812 0 0 8.507812 0 19 C 0 29.492188 8.507812 38 19 38 C 29.492188 38 38 29.492188 38 19 Z M 38 19 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 30.734375 15.292969 L 33.027344 12.800781 L 27.945312 12.800781 C 25.398438 11.058594 22.324219 10.046875 19 10.046875 C 15.679688 10.046875 12.613281 11.0625 10.074219 12.800781 L 4.976562 12.800781 L 7.269531 15.292969 C 5.863281 16.574219 4.984375 18.421875 4.984375 20.472656 C 4.984375 24.34375 8.121094 27.480469 11.988281 27.480469 C 13.828125 27.480469 15.503906 26.773438 16.753906 25.613281 L 19 28.058594 L 21.246094 25.613281 C 22.496094 26.773438 24.167969 27.480469 26.007812 27.480469 C 29.878906 27.480469 33.019531 24.34375 33.019531 20.472656 C 33.023438 18.421875 32.140625 16.574219 30.734375 15.292969 Z M 11.992188 25.214844 C 9.371094 25.214844 7.25 23.09375 7.25 20.472656 C 7.25 17.855469 9.371094 15.730469 11.992188 15.730469 C 14.613281 15.730469 16.734375 17.855469 16.734375 20.472656 C 16.734375 23.09375 14.613281 25.214844 11.992188 25.214844 Z M 19.003906 20.335938 C 19.003906 17.214844 16.734375 14.535156 13.738281 13.390625 C 15.355469 12.714844 17.132812 12.339844 19 12.339844 C 20.867188 12.339844 22.644531 12.714844 24.265625 13.390625 C 21.273438 14.539062 19.003906 17.214844 19.003906 20.335938 Z M 26.011719 25.214844 C 23.390625 25.214844 21.265625 23.09375 21.265625 20.472656 C 21.265625 17.855469 23.390625 15.730469 26.011719 15.730469 C 28.628906 15.730469 30.753906 17.855469 30.753906 20.472656 C 30.753906 23.09375 28.628906 25.214844 26.011719 25.214844 Z M 26.011719 17.984375 C 24.636719 17.984375 23.523438 19.097656 23.523438 20.472656 C 23.523438 21.84375 24.636719 22.957031 26.011719 22.957031 C 27.382812 22.957031 28.496094 21.84375 28.496094 20.472656 C 28.496094 19.101562 27.382812 17.984375 26.011719 17.984375 Z M 14.476562 20.472656 C 14.476562 21.847656 13.367188 22.960938 11.992188 22.960938 C 10.617188 22.960938 9.507812 21.847656 9.507812 20.472656 C 9.507812 19.097656 10.617188 17.988281 11.992188 17.988281 C 13.367188 17.984375 14.476562 19.097656 14.476562 20.472656 Z M 14.476562 20.472656 "/>
</g>
</svg>
                    {% elif review.source == 'google' %}
                      <!-- Google Logo -->
                      <svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.14685 10.8285C4.29724 8.43121 5.92263 6.40504 7.97107 4.72027C10.7469 2.42691 13.9308 1.04644 17.5008 0.623394C21.6941 0.126129 25.6351 0.920269 29.2793 3.1023C30.1847 3.6441 31.0308 4.26011 31.8398 4.92808C32.0402 5.09136 32.0179 5.18785 31.8472 5.35113C30.1922 6.99879 28.5371 8.64644 26.8969 10.3089C26.7039 10.5019 26.6 10.4871 26.3922 10.3312C21.5828 6.62769 14.5691 7.62965 10.9844 12.5281C10.3535 13.389 9.84138 14.3168 9.48513 15.3261C9.45544 15.4152 9.39607 15.4968 9.35154 15.5859C8.39412 14.8586 7.42927 14.1312 6.47927 13.3964C5.36599 12.5429 4.25271 11.6894 3.14685 10.8285Z" fill="#E94335"/>
                        <path d="M9.35151 22.5479C9.67065 23.2529 9.93784 23.9877 10.3386 24.6482C12.0234 27.4092 14.4281 29.183 17.5972 29.8139C20.4546 30.3854 23.2007 29.9994 25.7613 28.567C25.8503 28.5225 25.9394 28.4779 26.021 28.4334C26.0656 28.4779 26.1027 28.5299 26.1472 28.567C28.0621 30.0514 29.9843 31.5357 31.8992 33.0201C30.9789 33.933 29.9324 34.6678 28.8191 35.3061C25.5906 37.1467 22.0949 37.8889 18.4136 37.6068C13.8269 37.2506 9.87105 35.4396 6.60542 32.174C5.173 30.7416 3.99292 29.1236 3.1394 27.2756C3.93354 26.667 4.72769 26.0658 5.52183 25.4572C6.79839 24.485 8.07495 23.5201 9.35151 22.5479Z" fill="#34A853"/>
                        <path d="M31.9066 33.0199C29.9918 31.5355 28.0695 30.0512 26.1547 28.5668C26.1101 28.5297 26.0656 28.4777 26.0285 28.4332C26.689 27.9211 27.3644 27.4238 27.9062 26.7707C28.8117 25.6871 29.4129 24.4625 29.7246 23.0895C29.7617 22.9188 29.732 22.8594 29.5613 22.8668C29.4722 22.8742 29.3906 22.8668 29.3015 22.8668C26.2734 22.8668 23.2379 22.8594 20.2097 22.8742C19.8758 22.8742 19.8015 22.7852 19.809 22.466C19.8238 20.3137 19.8238 18.1613 19.809 16.009C19.809 15.7344 19.8832 15.6602 20.1578 15.6602C25.7094 15.6676 31.2609 15.6676 36.8199 15.6602C37.0574 15.6602 37.1539 15.7195 37.2133 15.9719C37.666 18.0129 37.6363 20.0613 37.3617 22.1246C37.139 23.7723 36.7383 25.368 36.1222 26.9117C35.2094 29.1902 33.866 31.1793 32.0996 32.8863C32.0328 32.9383 31.966 32.9754 31.9066 33.0199Z" fill="#4285F3"/>
                        <path d="M9.35153 22.5477C8.07497 23.5199 6.79841 24.4848 5.52185 25.457C4.72771 26.0582 3.93357 26.6668 3.13943 27.2754C2.52341 26.1324 2.12263 24.9227 1.79607 23.6758C1.17263 21.2637 1.07614 18.8145 1.41755 16.3578C1.68474 14.4281 2.24138 12.5727 3.13943 10.8359C4.25271 11.6895 5.35857 12.5504 6.47185 13.4039C7.42927 14.1387 8.38669 14.866 9.34411 15.5934C9.18083 16.3875 8.95075 17.1668 8.87653 17.9832C8.74294 19.4676 8.88396 20.9148 9.307 22.3398C9.33669 22.3992 9.34411 22.4734 9.35153 22.5477Z" fill="#FABB06"/>
                      </svg>
                    {% else %}
                      <!-- Fallback: Default review icon -->
                      <svg width="38" height="38" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="19" cy="19" r="19" fill="#DAC5A7"/>
                        <path d="M19 10L21.5 16.5H28L22.5 21L24.5 28L19 24L13.5 28L15.5 21L10 16.5H16.5L19 10Z" fill="white"/>
                      </svg>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
          {% endfor %}
        </div>
      </div>
      
      <div class="navAbsolute">
        <button class="navAbsolute__button bg-white js-slider1-prev">
          <i class="icon-arrow-left text-14"></i>
        </button>
        
        <button class="navAbsolute__button bg-white js-slider1-next">
          <i class="icon-arrow-right text-14"></i>
        </button>
      </div>
    </div>

    <!-- Информация о источниках и количестве отзывов -->
    <div class="row justify-center mt-30 source-info">
      <div class="col-auto">
        <div class="d-flex items-center justify-center bg-white rounded-8 px-20 py-10 shadow-1">
          <span class="text-13 text-light-2">
            {% if reviews_data.sources_used.tripadvisor and reviews_data.sources_used.google %}
              <i class="icon-check-circle text-green-1 mr-5"></i>
              {% trans "Reviews from TripAdvisor & Google" %}
            {% elif reviews_data.sources_used.tripadvisor %}
              <i class="icon-check-circle text-green-1 mr-5"></i>
              {% trans "Reviews from TripAdvisor" %}
            {% elif reviews_data.sources_used.google %}
              <i class="icon-check-circle text-green-1 mr-5"></i>
              {% trans "Reviews from Google" %}
            {% else %}
              <i class="icon-info-circle text-blue-1 mr-5"></i>
              {% trans "Sample reviews" %}
            {% endif %}
          </span>
          <span class="text-13 text-light-2 ml-15">•</span>
          <span class="text-13 text-light-2 ml-15">
            {% trans "Showing" %} {{ reviews_data.reviews|length }} {% trans "of" %} {{ reviews_data.total_reviews }} {% trans "reviews" %}
          </span>
          <span class="text-13 text-light-2 ml-15">•</span>
          <span class="text-13 text-light-2 ml-15">
            {% trans "Updated" %} {{ reviews_data.fetched_at }}
          </span>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- CSS для улучшения отображения -->
<style>
.tourCard {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.tourCard:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.author-thumb img,
.author-thumb div {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.tourCard__title {
    line-height: 1.4;
    min-height: 80px;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.testimonials__slider-meta-icon {
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.testimonials__slider-meta-icon:hover {
    opacity: 1;
}

/* Индикатор количества отзывов */
.source-info {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #e5e5e5;
    border-radius: 8px;
}

/* Улучшенная типографика для отзывов */
.tourCard__title {
    font-size: 15px;
    line-height: 1.5;
    color: #2d2d2d;
}

.testi-author .name {
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 2px;
}
</style>